var O=Object.defineProperty;var Z=(r,e,s)=>e in r?O(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var F=(r,e,s)=>(Z(r,typeof e!="symbol"?e+"":e,s),s);import{_ as q}from"./Card.vue_vue_type_script_setup_true_lang.91d58e92.js";import{_ as H}from"./NumberGroup.vue_vue_type_script_setup_true_lang.80c1ea0d.js";import{_ as U}from"./MainButton.vue_vue_type_script_setup_true_lang.8519f06e.js";import{c as Q,s as X}from"./api.0aed0be4.js";import{t as P,f as ee,h as _}from"./numbers.845fc6d6.js";import{c as te,P as N}from"./jackpot.a40b97db.js";import{TOKEN as re}from"./token.47c765a3.js";import{B as T}from"./ethers.0e708041.js";import{F as $,M as se,E as L,f as ne,a as ae}from"./ethers.281dcdcd.js";import{v as M,i as j,f as V,r as D,h as o,j as b,k as a,J as w,u as m,z as C,A as I,N as A,E as oe,C as ie,K as ce,F as me,P as le}from"./index.00545793.js";import{_ as de,a as ue}from"./Loading.15ed8f5e.js";import{u as fe}from"./wallet.d5ee502e.js";import{c as f}from"./networks.9fa95cd2.js";import"./loading.082cbd49.js";import"./error.7cedc883.js";import"./provider.f9cba9ce.js";import"./index.d593242d.js";import"./index.a0164a6e.js";import"./wallet.597f10bb.js";import"./pinia.4446b5c2.js";import"./LoadingIcon.5390b1a7.js";import"./_plugin-vue_export-helper.cdc0426e.js";class n{constructor(e){F(this,"fixedNumber");F(this,"bigNumber");this.value=e}static from(e){return new n(e)}add(e){return n.from(this.toFixedNumber().addUnsafe(n.from(e).toFixedNumber()))}sub(e){return n.from(this.toFixedNumber().subUnsafe(n.from(e).toFixedNumber()))}mul(e){return n.from(this.toFixedNumber().mulUnsafe(n.from(e).toFixedNumber()))}div(e){return n.from(this.toFixedNumber().divUnsafe(n.from(e).toFixedNumber()))}lt(e){return this.fixedToBigNumber().lt(n.from(e).fixedToBigNumber())}gt(e){return this.fixedToBigNumber().gt(n.from(e).fixedToBigNumber())}lte(e){return this.fixedToBigNumber().lte(n.from(e).fixedToBigNumber())}gte(e){return this.fixedToBigNumber().gte(n.from(e).fixedToBigNumber())}fixedToBigNumber(){return this.toBigNumber(this.toFixedNumber().format._multiplier)}toWei(e){return this.toBigNumber(T.from(10).pow(e.toString()))}toFixedNumber(){if(!this.fixedNumber){let e=this.value.toString();e.includes(".")||(e+=".0"),this.fixedNumber=$.from(e)}return this.fixedNumber}toBigNumber(e){return e?T.from(P(this.toFixedNumber().mulUnsafe($.from(e.toString())).toString())):(this.bigNumber||(this.bigNumber=T.from(P(this.value))),this.bigNumber)}toNumber(){return Number.parseFloat(this.toString())}toString(){return P(this.value.toString())}}const be={class:"border-red-500 w-full sm:w-auto shadow-md border rounded-lg inline-flex flex-col"},ge={class:"flex px-2 py-1 items-center justify-between border-b border-red-500 border-dashed"},he={class:"text-xs"},xe={class:"text-gray-400"},pe={class:"font-medium"},_e={key:0,class:"text-xs font-bold"},we={key:1,class:"text-xs font-bold text-gray-500"},Ne={class:"p-4 flex flex-col items-center justify-center"},ye={class:"mt-4 text-xs font-medium"},ke={class:"text-brown-600 font-bold"},ve={key:0},Be={key:1},Ce={class:"border-t border-dashed border-red-500 px-2 py-1"},Te={class:"text-center text-xs space-x-1"},Se=a("span",{class:"font-medium"},"Buy Date:",-1),Fe={class:"font-bold"},Pe=M({__name:"Ticket",props:{item:null},setup(r){const e=r,s=j("ball"),i=j(re),l=V(()=>{var x;return!((x=e.item.drawingNumbers.numbers)!=null&&x.length)}),y=V(()=>!l.value&&(!e.item.earned||n.from(e.item.earned).lte(0))),g=D(!1);async function h(){await Q(async()=>{await X(te,e.item.id).then(()=>g.value=!0)})}const c=V(()=>e.item.isClaimed||g.value);return(x,k)=>{var d;const v=U,p=H;return o(),b("div",be,[a("div",ge,[a("div",he,[a("p",xe,"#"+w(r.item.id),1),a("p",pe,w(new Date(r.item.drawingDate).toLocaleDateString()),1)]),a("div",null,[m(l)?(o(),b("span",_e,"Waiting...")):m(y)?(o(),b("span",we,"You lose!")):(o(),C(v,{key:2,disabled:m(c),"spacing-class":"px-2 py-0.5 text-xs rounded-full",onClick:h},{default:I(()=>[A(w(m(c)?"Claimed":"Claim"),1)]),_:1},8,["disabled"]))])]),a("div",Ne,[oe(p,{active:r.item.numbers.ball,"always-show-active":!!m(s),filled:r.item.drawingNumbers.numbers,numbers:r.item.numbers.numbers},null,8,["active","always-show-active","filled","numbers"]),a("p",ye,[A(" Earned: "),a("span",ke,[m(l)?(o(),b("span",ve,"---")):(o(),b("span",Be,w(m(ee)(r.item.earned||0))+" "+w((d=m(i))==null?void 0:d.symbol),1))])])]),a("div",Ce,[a("p",Te,[Se,a("span",Fe,w(new Date(r.item.buyDate).toLocaleString()),1)])])])}}}),z=new se({ethersProvider:L.rpcProvider}),Ve=N.connect(f.contracts.lottery,L.rpcProvider);async function De(r){return(await Ve.getTicketIds(r)).map(e=>e.toNumber()).sort((e,s)=>s-e)}async function Ie(r,e,s=[]){var E,R;let i=(await De(r)).filter(t=>!s.includes(t));if(e&&(i=i.splice(0,e)),!i)return[];const l=[{reference:"tickets",abi:N.abi,contractAddress:f.contracts.lottery,calls:i.map(t=>({reference:t.toString(),methodName:"getTicket",methodParameters:[r,t]}))},{reference:"prizes",abi:N.abi,contractAddress:f.contracts.lottery,calls:i.map(t=>({reference:t.toString(),methodName:"getPrize",methodParameters:[r,t]}))}],y=(await z.call(l)).results,g=(E=y.tickets)==null?void 0:E.callsReturnContext;if(!g)return[];const h=(R=y.prizes)==null?void 0:R.callsReturnContext;if(!h)return[];const c=g.map(t=>({id:t.reference,buyDate:_(t.returnValues[0].hex)*1e3,drawingId:_(t.returnValues[1]),isClaimed:t.returnValues[2],numbers:{numbers:t.returnValues[3].map(B=>_(B.hex))}})),x={reference:"earned",abi:N.abi,contractAddress:f.contracts.lottery,calls:h.map(t=>{const B=c.find(S=>t.reference==S.id);return{reference:t.reference,methodName:"getPrizeTokens",methodParameters:[B.drawingId,_(t.returnValues[0].hex)]}})},k=[...new Set(c.map(t=>t.drawingId))],v=[{reference:"drawings",abi:N.abi,contractAddress:f.contracts.lottery,calls:k.map(t=>({reference:t.toString(),methodName:"getDrawing",methodParameters:[t]}))},{reference:"drawingNumbers",abi:N.abi,contractAddress:f.contracts.lottery,calls:k.map(t=>({reference:t.toString(),methodName:"getDrawingNumbers",methodParameters:[t]}))}],p={reference:"token",abi:ae.abi,contractAddress:f.contracts.token,calls:[{reference:"decimals",methodName:"decimals",methodParameters:[]}]},d=(await z.call([x,...v,p])).results,W=d.earned.callsReturnContext,Y=d.drawings.callsReturnContext,K=d.drawingNumbers.callsReturnContext,G=d.token.callsReturnContext[0].returnValues[0];return c.map(t=>{const B=T.from(W.find(u=>u.reference==t.id).returnValues[0].hex),S=_(Y.find(u=>u.reference==t.drawingId.toString()).returnValues[0].hex),J=K.find(u=>u.reference==t.drawingId.toString()).returnValues.map(u=>_(u.hex));return{...t,earned:ne(B,G),drawingDate:S*1e3,drawingNumbers:{numbers:J}}})}const Ae={key:2,class:"flex flex-col items-center justify-center space-y-4"},Ee={class:"flex -mt-4 -mr-4 items-center justify-center flex-wrap"},at=M({__name:"tickets",setup(r){const e=fe(),s=D([]),i=D(!0);async function l(){!e.address||(i.value=!0,s.value=await Ie(e.address),i.value=!1)}return ie(l),(y,g)=>{const h=de,c=ue,x=U,k=Pe,v=q;return o(),C(v,{title:"Your Tickets"},{default:I(()=>[i.value?(o(),C(h,{key:0})):s.value.length<=0?(o(),C(c,{key:1},{default:I(()=>[A("You don't have any tickets!")]),_:1})):(o(),b("div",Ae,[ce("",!0),a("div",Ee,[(o(!0),b(me,null,le(s.value,p=>(o(),C(k,{key:p.id,item:p,class:"mt-4 mr-4"},null,8,["item"]))),128))])]))]),_:1})}}});export{at as default};
