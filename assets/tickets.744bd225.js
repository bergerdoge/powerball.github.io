var K=Object.defineProperty;var Z=(r,e,s)=>e in r?K(r,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[e]=s;var F=(r,e,s)=>(Z(r,typeof e!="symbol"?e+"":e,s),s);import{_ as q}from"./Card.vue_vue_type_script_setup_true_lang.cfc1bc08.js";import{_ as H}from"./NumberGroup.vue_vue_type_script_setup_true_lang.91eec52d.js";import{_ as j}from"./MainButton.vue_vue_type_script_setup_true_lang.c3c78eea.js";import{c as O,s as Q}from"./api.aa8deb11.js";import{t as P,f as X,h}from"./numbers.845fc6d6.js";import{c as ee,P as x}from"./jackpot.ebe3c42d.js";import{B as C}from"./ethers.0e708041.js";import{F as U,M as te,E as z,f as re,a as se}from"./ethers.d3dee471.js";import{v as L,i as ne,f as V,r as D,h as i,j as f,k as o,J as y,u as d,z as k,A as I,N as A,E as ae,C as oe,K as ie,F as ce,P as me}from"./index.6d1f7639.js";import{_ as le,a as de}from"./Loading.e99e4ca1.js";import{u as ue}from"./wallet.aae57044.js";import{c as u}from"./networks.d485a67c.js";import"./loading.dbcf0dd1.js";import"./error.4c90b432.js";import"./provider.d6c01b7a.js";import"./index.c718f2ec.js";import"./index.d5177290.js";import"./wallet.bfdf9328.js";import"./LoadingIcon.45f095ee.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./pinia.5e92fd8e.js";class n{constructor(e){F(this,"fixedNumber");F(this,"bigNumber");this.value=e}static from(e){return new n(e)}add(e){return n.from(this.toFixedNumber().addUnsafe(n.from(e).toFixedNumber()))}sub(e){return n.from(this.toFixedNumber().subUnsafe(n.from(e).toFixedNumber()))}mul(e){return n.from(this.toFixedNumber().mulUnsafe(n.from(e).toFixedNumber()))}div(e){return n.from(this.toFixedNumber().divUnsafe(n.from(e).toFixedNumber()))}lt(e){return this.fixedToBigNumber().lt(n.from(e).fixedToBigNumber())}gt(e){return this.fixedToBigNumber().gt(n.from(e).fixedToBigNumber())}lte(e){return this.fixedToBigNumber().lte(n.from(e).fixedToBigNumber())}gte(e){return this.fixedToBigNumber().gte(n.from(e).fixedToBigNumber())}fixedToBigNumber(){return this.toBigNumber(this.toFixedNumber().format._multiplier)}toWei(e){return this.toBigNumber(C.from(10).pow(e.toString()))}toFixedNumber(){if(!this.fixedNumber){let e=this.value.toString();e.includes(".")||(e+=".0"),this.fixedNumber=U.from(e)}return this.fixedNumber}toBigNumber(e){return e?C.from(P(this.toFixedNumber().mulUnsafe(U.from(e.toString())).toString())):(this.bigNumber||(this.bigNumber=C.from(P(this.value))),this.bigNumber)}toNumber(){return Number.parseFloat(this.toString())}toString(){return P(this.value.toString())}}const fe={class:"border-red-500 w-full sm:w-auto shadow-md border rounded-lg inline-flex flex-col"},be={class:"flex px-2 py-1 items-center justify-between border-b border-red-500 border-dashed"},ge={class:"text-xs"},he={class:"text-gray-400"},xe={class:"font-medium"},pe={key:0,class:"text-xs font-bold"},_e={key:1,class:"text-xs font-bold text-gray-500"},we={class:"p-4 flex flex-col items-center justify-center"},Ne={class:"mt-4 text-xs font-medium"},ye={class:"text-brown-600 font-bold"},ke={key:0},ve={key:1},Be={class:"border-t border-dashed border-red-500 px-2 py-1"},Ce={class:"text-center text-xs space-x-1"},Te=o("span",{class:"font-medium"},"Buy Date:",-1),Se={class:"font-bold"},Fe=L({__name:"Ticket",props:{item:null},setup(r){const e=r,s=ne("ball"),a=V(()=>{var c;return!((c=e.item.drawingNumbers.numbers)!=null&&c.length)}),p=V(()=>!a.value&&(!e.item.earned||n.from(e.item.earned).lte(0))),b=D(!1);async function _(){await O(async()=>{await Q(ee,e.item.id).then(()=>b.value=!0)})}const m=V(()=>e.item.isClaimed||b.value);return(c,T)=>{const g=j,w=H;return i(),f("div",fe,[o("div",be,[o("div",ge,[o("p",he,"#"+y(r.item.id),1),o("p",xe,y(new Date(r.item.drawingDate).toLocaleDateString()),1)]),o("div",null,[d(a)?(i(),f("span",pe,"Waiting...")):d(p)?(i(),f("span",_e,"You lose!")):(i(),k(g,{key:2,disabled:d(m),"spacing-class":"px-2 py-0.5 text-xs rounded-full",onClick:_},{default:I(()=>[A(y(d(m)?"Claimed":"Claim"),1)]),_:1},8,["disabled"]))])]),o("div",we,[ae(w,{active:r.item.numbers.ball,"always-show-active":!!d(s),filled:r.item.drawingNumbers.numbers,numbers:r.item.numbers.numbers},null,8,["active","always-show-active","filled","numbers"]),o("p",Ne,[A(" Earned: "),o("span",ye,[d(a)?(i(),f("span",ke,"---")):(i(),f("span",ve,y(d(X)(r.item.earned||0))+" BUSD",1))])])]),o("div",Be,[o("p",Ce,[Te,o("span",Se,y(new Date(r.item.buyDate).toLocaleString()),1)])])])}}}),$=new te({ethersProvider:z.rpcProvider}),Pe=x.connect(u.contracts.lottery,z.rpcProvider);async function Ve(r){return(await Pe.getTicketIds(r)).map(e=>e.toNumber()).sort((e,s)=>s-e)}async function De(r,e,s=[]){var R,E;let a=(await Ve(r)).filter(t=>!s.includes(t));if(e&&(a=a.splice(0,e)),!a)return[];const p=[{reference:"tickets",abi:x.abi,contractAddress:u.contracts.lottery,calls:a.map(t=>({reference:t.toString(),methodName:"getTicket",methodParameters:[r,t]}))},{reference:"prizes",abi:x.abi,contractAddress:u.contracts.lottery,calls:a.map(t=>({reference:t.toString(),methodName:"getPrize",methodParameters:[r,t]}))}],b=(await $.call(p)).results,_=(R=b.tickets)==null?void 0:R.callsReturnContext;if(!_)return[];const m=(E=b.prizes)==null?void 0:E.callsReturnContext;if(!m)return[];const c=_.map(t=>({id:t.reference,buyDate:h(t.returnValues[0].hex)*1e3,drawingId:h(t.returnValues[1]),isClaimed:t.returnValues[2],numbers:{numbers:t.returnValues[3].map(N=>h(N.hex))}})),T={reference:"earned",abi:x.abi,contractAddress:u.contracts.lottery,calls:m.map(t=>{const N=c.find(S=>t.reference==S.id);return{reference:t.reference,methodName:"getPrizeTokens",methodParameters:[N.drawingId,h(t.returnValues[0].hex)]}})},g=[...new Set(c.map(t=>t.drawingId))],w=[{reference:"drawings",abi:x.abi,contractAddress:u.contracts.lottery,calls:g.map(t=>({reference:t.toString(),methodName:"getDrawing",methodParameters:[t]}))},{reference:"drawingNumbers",abi:x.abi,contractAddress:u.contracts.lottery,calls:g.map(t=>({reference:t.toString(),methodName:"getDrawingNumbers",methodParameters:[t]}))}],v={reference:"token",abi:se.abi,contractAddress:u.contracts.token,calls:[{reference:"decimals",methodName:"decimals",methodParameters:[]}]},B=(await $.call([T,...w,v])).results,M=B.earned.callsReturnContext,W=B.drawings.callsReturnContext,Y=B.drawingNumbers.callsReturnContext,G=B.token.callsReturnContext[0].returnValues[0];return c.map(t=>{const N=C.from(M.find(l=>l.reference==t.id).returnValues[0].hex),S=h(W.find(l=>l.reference==t.drawingId.toString()).returnValues[0].hex),J=Y.find(l=>l.reference==t.drawingId.toString()).returnValues.map(l=>h(l.hex));return{...t,earned:re(N,G),drawingDate:S*1e3,drawingNumbers:{numbers:J}}})}const Ie={key:2,class:"flex flex-col items-center justify-center space-y-4"},Ae={class:"flex -mt-4 -mr-4 items-center justify-center flex-wrap"},st=L({__name:"tickets",setup(r){const e=ue(),s=D([]),a=D(!0);async function p(){!e.address||(a.value=!0,s.value=await De(e.address),a.value=!1)}return oe(p),(b,_)=>{const m=le,c=de,T=j,g=Fe,w=q;return i(),k(w,{title:"Your Tickets"},{default:I(()=>[a.value?(i(),k(m,{key:0})):s.value.length<=0?(i(),k(c,{key:1},{default:I(()=>[A("You don't have any tickets!")]),_:1})):(i(),f("div",Ie,[ie("",!0),o("div",Ae,[(i(!0),f(ce,null,me(s.value,v=>(i(),k(g,{key:v.id,item:v,class:"mt-4 mr-4"},null,8,["item"]))),128))])]))]),_:1})}}});export{st as default};
